{% load static %}
{% load leaflet_tags %}

<head>
    <script src="{{ STATIC_URL }}/js/jquery.js"></script>
    {% leaflet_js %}
    {% leaflet_css %}
    <style>

        .leaflet-container {
            width:  100%;
            height: 100%;
        }

    </style>
    <!--[if IE 8]><script src="{% static "leaflet/eventlister.ie8.js" %}"></script><!--<![endif]-->
    <!--[if lt IE 8]><script src="{% static "leaflet/eventlister.ie6-7.js" %}"></script><!--<![endif]-->
</head>
<body>
    {% leaflet_map "map" callback="window.map_init_basic" %}
    <script>
        function map_init_basic (map, options)
        {
            //var map = L.map('map')
            var layer_stats = new L.geoJson();
            layer_stats.addTo(map);
            $.ajax(
            {
                dataType: "json",
                url: "{% url 'stats_geojson' 15 'count' %}",
                success : function (response)
                {
                    layer_stats = L.geoJson(response,
                    {
                        onEachFeature: function (feature, layer)
                        {
                            var popupOptions = {maxWidth: 400};
                            //layer.setIcon(mapgiveIcon);
                            var properties = feature.properties
                            var popupContent = "<h4>Location: " + properties.location + "<br>Count: " + properties.count + "</h4>";
                            layer.bindPopup(popupContent,popupOptions);
                        },
                        style: function(feature)
                        {
                            var count = feature.properties.count
                            var blue = 0.1;
                            if(count > 10)
                                blue = 1.0;
                            else if(count > 5)
                                blue = 0.5;
                            else if(count > 2)
                                blue = 0.25

                            return {'opacity':0.0,'fillOpacity': 0.6,'fillColor':'rgb(0,0,'+(128*blue)+')'}
		        }
                    }).addTo(map);
                    map.fitBounds(layer_stats.getBounds());
                }
            }).error(function() {});
        }
    </script>
</body>
